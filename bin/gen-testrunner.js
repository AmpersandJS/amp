// Generates a file called `test-all.js`
// in this directory. This is for easy
// browserifiable testing of all modules
// for the CI hook.

/*global console*/
var fs = require('fs');
var packages = require('../lib/get-packages')();
var buff = '// this file generated by bin/gen-testrunner.js\n';
var buffServer = '// this file generated by bin/gen-testrunner.js\n';
var out = __dirname + '/test-all.js';
var outServer = __dirname + '/test-server.js';

function getRequire(name) {
    return 'require(\'../modules/' + name + '/test\');\n';
}

packages.forEach(function (pack) {
    buff += getRequire(pack.bareName);
    if (pack.category !== 'dom') {
        buffServer += getRequire(pack.bareName);
    }
});

fs.writeFileSync(out, buff, 'utf8');
fs.writeFileSync(outServer, buffServer, 'utf8');

console.log('built ' + out);
console.log('built ' + outServer);
